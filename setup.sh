#!/bin/bash

# Function to check if a command exists
command_exists() {
    command -v "$1" >/dev/null 2>&1
}

# Install Nmap if not installed
if command_exists nmap; then
    echo "Nmap is already installed."
else
    echo "Installing Nmap..."
    sudo apt update
    sudo apt install -y nmap
    if command_exists nmap; then
        echo "Nmap installation successful."
    else
        echo "Nmap installation failed."
        exit 1
    fi
fi

# Install Nikto if not installed
if command_exists nikto; then
    echo "Nikto is already installed."
else
    echo "Installing Nikto..."
    sudo apt update
    sudo apt install -y nikto
    if command_exists nikto; then
        echo "Nikto installation successful."
    else
        echo "Nikto installation failed."
        exit 1
    fi
fi

# Install Oracle Java 8
if command_exists java; then
    echo "Java is already installed."
else
    echo "Installing Oracle Java 8..."
    sudo add-apt-repository -y ppa:webupd8team/java
    sudo apt-get update
    sudo apt-get -y install oracle-java8-installer
    if command_exists java; then
        echo "Oracle Java 8 installation successful."
    else
        echo "Oracle Java 8 installation failed."
        exit 1
    fi
fi


# Install Metasploit Framework
if command_exists msfconsole; then
    echo "Metasploit is already installed."
else
    echo "Installing Metasploit dependencies..."
    sudo apt-get update
    sudo apt-get -y install build-essential libreadline-dev libssl-dev libpq5 libpq-dev libreadline5 libsqlite3-dev libpcap-dev git-core autoconf postgresql pgadmin3 curl zlib1g-dev libxml2-dev libxslt1-dev libyaml-dev curl zlib1g-dev gawk bison libffi-dev libgdbm-dev libncurses5-dev libtool sqlite3 libgmp-dev gnupg2 dirmngr

    echo "Installing Metasploit..."
    git clone https://github.com/rapid7/metasploit-framework.git /usr/local/src/metasploit-framework
    sudo bash -c 'for MSF in $(ls /usr/local/src/metasploit-framework/msf*); do ln -s $MSF /usr/local/bin/$(basename $MSF); done'

    echo "Starting PostgreSQL and setting up the Metasploit database..."
    sudo service postgresql start
    sudo msfdb init

    if command_exists msfconsole; then
        echo "Metasploit installation successful."
    else
        echo "Metasploit installation failed."
        exit 1
    fi
fi


# Setup complete
echo "Setup complete!"
